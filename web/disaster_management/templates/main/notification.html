{% extends "base_generic.html" %}
{% block script %}
    var lastNotification = "1";
{% endblock %}
{% block include_header %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js" type="text/javascript"></script>
{% endblock %}
{% block content %}

<div class="container">
    <ul id = "notf_list">
        {% if not notifications %}
            <h4>No notifications</h4>
        {% else %}
            {% for x in notifications %}
                <li><h4>{{ x }}</h4></li>
            {% endfor %}
            <script>
                lastNotification = "{{ notifications.0.date }}";
            </script>
        
        {% endif %}
    </ul>
</div>
{% endblock %}

{% block javascript %}
<script>

// Global variable to store time-date of last notification displayed
setInterval(function () {
        console.log('Called new notifications at : ' + new Date());
        $.ajax({
            type: 'GET',
            url: "{% url 'main:get_new_notifications' notfLocIndex %}",
            success: function (response) {
                // console.log(response);
                // console.log(lastNotification);
                var newnotfs = response["new_notifications"];
                console.log(newnotfs);
                // var constantDate = new Date(lastNotification);
                var constantDate = moment( lastNotification , 'DD-MM-YYYY HH:mm:ss').toDate();

                for (notf in newnotfs) {
                    // console.log(newnotfs[notf]['date']);
                    // console.log(newnotfs[notf]);
                    // var newDate = Date.parse(newnotfs[notf]['date'], "dd-MM-yyyy HH:mm:ss");
                    var newDate = moment( newnotfs[notf]['date'] , 'DD-MM-YYYY HH:mm:ss').toDate();

                    // var newDate = new Date(newnotfs[notf]['date']);
                    console.log(lastNotification);
                    console.log(newnotfs[notf]['date']);
                    console.log(newDate);
                    console.log(constantDate);
                    var momentDate = moment('2015-01-16 22:15:00', 'YYYY-MM-DD HH:mm:ss');
                    var jsDate = momentDate.toDate();
                    console.log("hello");

                    console.log(jsDate);



                    if( newDate > constantDate ) {
                        $('#notf_list').prepend(
                            '<li><h4>'+ JSON.stringify(newnotfs[notf]) +'</h4></li>'
                        )
                        lastNotification = newnotfs[notf]['date'];
                    }
                }
            },
            error: function (response) {
                console.log("dsadsadsaasdsadsadsadasads!@!@!@!@!@!!@!@!");

                //console.log(response)
            }
        })
    },10000);
</script>
{% endblock javascript %}