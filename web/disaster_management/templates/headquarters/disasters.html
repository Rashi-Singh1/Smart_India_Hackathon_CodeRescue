{% extends "base_generic.html" %}

{% block content %}
{% csrf_token %}
<div class = "container">
    <h3>All Disasters</h3>
    <hr>
    {% for disaster in disasters_data %}
        <!-- <form> -->
            <!-- {% csrf_token %} -->
        <h4><label for="{{ disaster.id }}"> {{ disaster.name }}</label>
        <input type="checkbox" class = "disasterClass" id="{{ disaster.id }}" name="{{ disaster.id }}"
        value="{{ disaster.id }}" {% if disaster.isactive == 1 %} checked {% endif %}></h4>
        <!-- </form> -->
        <b>Locations:</b>
        {% for loc in disaster.location %}
            {{loc}},
        {% endfor %}
        <br>
        <hr>
    {% endfor%}
</div>

{% endblock %}


{% block javascript %}

<script>
$(".disasterClass").change(function() {
    var status = this.checked ? 1 : 0;
    console.log($(this).attr("id"));
    var id = $(this).attr("id");
    var token = $('input[name="csrfmiddlewaretoken"]').attr('value');
    console.log(token);
    // $.ajaxSetup({
    //     beforeSend: function(xhr) {
    //         xhr.setRequestHeader('Csrf-Token', token);
    //     }
    // });
    $.ajax({
        type: 'POST',
        url: "{% url 'main:change_active_status' %}",
        data: {"status" : status, "id" : id, "csrfmiddlewaretoken" : token},
        // headers: { 'Csrf-Token': token },
        success: function (response) {
            console.log("Active status of " + id + " changed successfully to " + status + "!")
        },
        error: function (response) {
            alert(response["error"]);
        }
    });
});
</script>

{% endblock javascript %}
