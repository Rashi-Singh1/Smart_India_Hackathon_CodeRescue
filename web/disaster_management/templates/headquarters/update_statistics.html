{% extends "base_generic.html" %}

{% block css %}
<style>
* {
  .border-radius(0) !important;
}

#field {
    margin-bottom:20px;
}

.daily_stats {
  display: flex;
  flex-direction: row;
}

</style>
{% endblock %}

{% block script %}

{% endblock %}

{% block include_header %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
{% endblock %}


{% block content%}

<div class = "container">
    <center>
    <h1> {{ disaster_name }} </h1>
    <b>Locations:</b>
    {% for loc in location %}
        {{loc}},
    {% endfor %}
    </center>
    <hr>

    <form action="{% url 'main:update_statistics' disaster_id %}" method="post">
        {% csrf_token %}
        <div class="col-xs-12">
               <div class="col-md-12" >
                   <h3> Total Statistics: {{ total_stats }} </h3>

                   <br><br>
                    <h3> Daily Statistics: </h3>

                    <div id="field">
                        {% for x in daily_stats %}
                        <div id="field{{ forloop.counter|add:'-1' }}">
                            <div class="form-group">
                                <div class="daily_stats">
                                    Day {{ forloop.counter }} :
                                    <input id="affected_stats" name="affected_stats" type="text" placeholder="" class="form-control input-md" value="{{ x.affected }}">
                                    <input id="deaths_stats" name="deaths_stats" type="text" placeholder="" class="form-control input-md" value="{{ x.deaths }}">
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="form-group">
                        <div class="col-md-4">
                            <button id="add-more" name="add-more" class="btn btn-primary">Add More</button>
                        </div>
                    </div>
                    <br><br>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
    </form>
</div>
{% endblock %}

{% block javascript %}
<script>
    var next = {{ daily_stats|length }};
    next--;
    console.log(next);
    $(document).ready(function () {
        $("#add-more").click(function(e){
            e.preventDefault();
            var addto = "#field" + next;
            // var addRemove = "#field" + (next);
            next = next + 1;
            var newIn = ' <div id="field'+ next +'" name="field'+ next + '"> \
                <div class="form-group"> \
                    <div class="daily_stats"> \
                        Day ' + (next+1) + ' : \
                        <input id="affected_stats" name="affected_stats" type="text" placeholder="" class="form-control input-md" value="0"> \
                        <input id="deaths_stats" name="deaths_stats" type="text" placeholder="" class="form-control input-md" value="0"> \
                    </div> \
                </div> </div>';
            var newInput = $(newIn);
            $(addto).after(newInput);
            $("#field" + next).attr('data-source',$(addto).attr('data-source'));
            $("#count").val(next);
        });
    });
</script>

{% endblock javascript %}
